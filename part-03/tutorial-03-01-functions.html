<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Tutorial III.I - Functions</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="tutorial-03-01-functions_files/libs/clipboard/clipboard.min.js"></script>
<script src="tutorial-03-01-functions_files/libs/quarto-html/quarto.js"></script>
<script src="tutorial-03-01-functions_files/libs/quarto-html/popper.min.js"></script>
<script src="tutorial-03-01-functions_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="tutorial-03-01-functions_files/libs/quarto-html/anchor.min.js"></script>
<link href="tutorial-03-01-functions_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="tutorial-03-01-functions_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="tutorial-03-01-functions_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="tutorial-03-01-functions_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="tutorial-03-01-functions_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#functions-in-julia" id="toc-functions-in-julia" class="nav-link active" data-scroll-target="#functions-in-julia">Functions in Julia</a></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section">==============================</a>
  <ul class="collapse">
  <li><a href="#section-1-creating-and-calling-functions" id="toc-section-1-creating-and-calling-functions" class="nav-link" data-scroll-target="#section-1-creating-and-calling-functions">Section 1: Creating and Calling Functions</a></li>
  </ul></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1">—————————————–</a>
  <ul class="collapse">
  <li><a href="#exercise-1.1" id="toc-exercise-1.1" class="nav-link" data-scroll-target="#exercise-1.1">Exercise 1.1:</a></li>
  </ul></li>
  <li><a href="#your-code-below" id="toc-your-code-below" class="nav-link" data-scroll-target="#your-code-below">YOUR CODE BELOW</a></li>
  <li><a href="#your-code-above" id="toc-your-code-above" class="nav-link" data-scroll-target="#your-code-above">YOUR CODE ABOVE</a></li>
  <li><a href="#test-your-function" id="toc-test-your-function" class="nav-link" data-scroll-target="#test-your-function">Test your function</a>
  <ul class="collapse">
  <li><a href="#section-2-scope-within-functions" id="toc-section-2-scope-within-functions" class="nav-link" data-scroll-target="#section-2-scope-within-functions">Section 2: Scope within Functions</a></li>
  </ul></li>
  <li><a href="#section-2" id="toc-section-2" class="nav-link" data-scroll-target="#section-2">———————————</a>
  <ul class="collapse">
  <li><a href="#exercise-2.1" id="toc-exercise-2.1" class="nav-link" data-scroll-target="#exercise-2.1">Exercise 2.1:</a></li>
  </ul></li>
  <li><a href="#your-changes-below" id="toc-your-changes-below" class="nav-link" data-scroll-target="#your-changes-below">YOUR CHANGES BELOW</a></li>
  <li><a href="#your-changes-above" id="toc-your-changes-above" class="nav-link" data-scroll-target="#your-changes-above">YOUR CHANGES ABOVE</a></li>
  <li><a href="#test-your-function-1" id="toc-test-your-function-1" class="nav-link" data-scroll-target="#test-your-function-1">Test your function</a>
  <ul class="collapse">
  <li><a href="#exercise-2.2" id="toc-exercise-2.2" class="nav-link" data-scroll-target="#exercise-2.2">Exercise 2.2:</a></li>
  </ul></li>
  <li><a href="#your-code-below-1" id="toc-your-code-below-1" class="nav-link" data-scroll-target="#your-code-below-1">YOUR CODE BELOW</a></li>
  <li><a href="#your-code-above-1" id="toc-your-code-above-1" class="nav-link" data-scroll-target="#your-code-above-1">YOUR CODE ABOVE</a></li>
  <li><a href="#test-your-function-2" id="toc-test-your-function-2" class="nav-link" data-scroll-target="#test-your-function-2">Test your function</a>
  <ul class="collapse">
  <li><a href="#section-3-anonymous-functions" id="toc-section-3-anonymous-functions" class="nav-link" data-scroll-target="#section-3-anonymous-functions">Section 3: Anonymous Functions</a></li>
  </ul></li>
  <li><a href="#section-3" id="toc-section-3" class="nav-link" data-scroll-target="#section-3">——————————</a>
  <ul class="collapse">
  <li><a href="#exercise-3.1" id="toc-exercise-3.1" class="nav-link" data-scroll-target="#exercise-3.1">Exercise 3.1:</a></li>
  </ul></li>
  <li><a href="#create-an-anonymous-function-multiply-that-multiplies-two-numbers." id="toc-create-an-anonymous-function-multiply-that-multiplies-two-numbers." class="nav-link" data-scroll-target="#create-an-anonymous-function-multiply-that-multiplies-two-numbers.">Create an anonymous function ‘multiply’ that multiplies two numbers.</a></li>
  <li><a href="#your-code-below-2" id="toc-your-code-below-2" class="nav-link" data-scroll-target="#your-code-below-2">YOUR CODE BELOW</a></li>
  <li><a href="#your-code-above-2" id="toc-your-code-above-2" class="nav-link" data-scroll-target="#your-code-above-2">YOUR CODE ABOVE</a></li>
  <li><a href="#test-your-function-3" id="toc-test-your-function-3" class="nav-link" data-scroll-target="#test-your-function-3">Test your function</a>
  <ul class="collapse">
  <li><a href="#section-4-multiple-dispatch" id="toc-section-4-multiple-dispatch" class="nav-link" data-scroll-target="#section-4-multiple-dispatch">Section 4: Multiple Dispatch</a></li>
  </ul></li>
  <li><a href="#section-4" id="toc-section-4" class="nav-link" data-scroll-target="#section-4">—————————-</a></li>
  <li><a href="#the-specific-implementations-are" id="toc-the-specific-implementations-are" class="nav-link" data-scroll-target="#the-specific-implementations-are">The specific implementations are:</a></li>
  <li><a href="#test-with-different-types-of-arguments." id="toc-test-with-different-types-of-arguments." class="nav-link" data-scroll-target="#test-with-different-types-of-arguments.">Test with different types of arguments.</a>
  <ul class="collapse">
  <li><a href="#exercise-4.1" id="toc-exercise-4.1" class="nav-link" data-scroll-target="#exercise-4.1">Exercise 4.1:</a></li>
  </ul></li>
  <li><a href="#your-changes-below-1" id="toc-your-changes-below-1" class="nav-link" data-scroll-target="#your-changes-below-1">YOUR CHANGES BELOW</a></li>
  <li><a href="#your-changes-above-1" id="toc-your-changes-above-1" class="nav-link" data-scroll-target="#your-changes-above-1">YOUR CHANGES ABOVE</a>
  <ul class="collapse">
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul></li>
  <li><a href="#section-5" id="toc-section-5" class="nav-link" data-scroll-target="#section-5">———–</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="../tutorial-03-01-functions.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Tutorial III.I - Functions</h1>
<p class="subtitle lead">Applied Optimization with Julia</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="functions-in-julia" class="level1">
<h1>Functions in Julia</h1>
</section>
<section id="section" class="level1">
<h1>==============================</h1>
<p>println() println(“Functions in Julia”) println()</p>
<p>#= This interactive Julia script is a comprehensive guide to understanding functions in Julia. Dive into the creation and usage of functions, grasp the concept of scope within functions, explore returning values, use anonymous functions, and leverage multiple dispatch for versatile function behavior. Follow the instructions, input your code in the designated areas, and verify your implementations with <span class="citation" data-cites="assert">@assert</span> statements. =#</p>
<section id="section-1-creating-and-calling-functions" class="level2">
<h2 class="anchored" data-anchor-id="section-1-creating-and-calling-functions">Section 1: Creating and Calling Functions</h2>
</section>
</section>
<section id="section-1" class="level1">
<h1>—————————————–</h1>
<p>println(“Section 1: Creating and Calling Functions”)</p>
<p>#= Functions in Julia encapsulate reusable code and can be defined using the ‘function’ keyword or shorthand syntax. After the keyword, you name the function and write the parameters in parentheses. For example:</p>
<p>function multiply(a,b) a * b end</p>
<p>This function takes two parameters, multiplies them, and returns the result implicitly. In Julia, the last expression is automatically returned, making the ‘return’ keyword optional. =#</p>
<section id="exercise-1.1" class="level2">
<h2 class="anchored" data-anchor-id="exercise-1.1">Exercise 1.1:</h2>
<p>#= Define and Test a Simple Addition Function. Define a function ‘add’ that takes two parameters and returns their sum. =#</p>
</section>
</section>
<section id="your-code-below" class="level1">
<h1>YOUR CODE BELOW</h1>
</section>
<section id="your-code-above" class="level1">
<h1>YOUR CODE ABOVE</h1>
</section>
<section id="test-your-function" class="level1">
<h1>Test your function</h1>
<p><span class="citation" data-cites="assert">@assert</span> add(10, 5) == 15 “The sum computed is $(add(10, 5)) but should be 15.”</p>
<section id="section-2-scope-within-functions" class="level2">
<h2 class="anchored" data-anchor-id="section-2-scope-within-functions">Section 2: Scope within Functions</h2>
</section>
</section>
<section id="section-2" class="level1">
<h1>———————————</h1>
<p>println(“Section 2: Scope within Functions”)</p>
<p>#= Variables declared inside a function are local to that function and are not accessible outside. If you want to access the variable outside of the function, you have to explicitly return it. You can do this by passing ‘return’ in front of the variable you want to return from the function. =#</p>
<section id="exercise-2.1" class="level2">
<h2 class="anchored" data-anchor-id="exercise-2.1">Exercise 2.1:</h2>
<p>#= Try to execude the following block of code. The objective is to understand how to return the ‘local_variable_one’ from the function ‘scope_test’. Your task is to change the function, to return the value of ‘local_variable_one’. =#</p>
</section>
</section>
<section id="your-changes-below" class="level1">
<h1>YOUR CHANGES BELOW</h1>
<p>function scope_test() local_variable_one = 10 local_variable_two = 20 end</p>
</section>
<section id="your-changes-above" class="level1">
<h1>YOUR CHANGES ABOVE</h1>
</section>
<section id="test-your-function-1" class="level1">
<h1>Test your function</h1>
<p><span class="citation" data-cites="assert">@assert</span> scope_test() == 10 “The value exported is $(scope_test()).”</p>
<section id="exercise-2.2" class="level2">
<h2 class="anchored" data-anchor-id="exercise-2.2">Exercise 2.2:</h2>
<p>#= Define and Test an Implicit Return Function. Define a function ‘subtract’ that takes two parameters and implicitly returns their difference. The implicit return feature makes your code cleaner and more concise. =#</p>
</section>
</section>
<section id="your-code-below-1" class="level1">
<h1>YOUR CODE BELOW</h1>
</section>
<section id="your-code-above-1" class="level1">
<h1>YOUR CODE ABOVE</h1>
</section>
<section id="test-your-function-2" class="level1">
<h1>Test your function</h1>
<p><span class="citation" data-cites="assert">@assert</span> subtract(10, 5) == 5 “The difference computed is $(subtract(10, 5)) but should be 5.”</p>
<section id="section-3-anonymous-functions" class="level2">
<h2 class="anchored" data-anchor-id="section-3-anonymous-functions">Section 3: Anonymous Functions</h2>
</section>
</section>
<section id="section-3" class="level1">
<h1>——————————</h1>
<p>println(“Section 3: Anonymous Functions”)</p>
<p>#= Anonymous functions in Julia are unnamed functions, useful for concise and short operations. They are particularly useful for operations that are passed as arguments to higher-order functions or used for short, one-off computations. Syntax for anonymous functions can be either of the following: add_two = (a,b) -&gt; a + b add_two(a,b) = a + b =#</p>
<section id="exercise-3.1" class="level2">
<h2 class="anchored" data-anchor-id="exercise-3.1">Exercise 3.1:</h2>
</section>
</section>
<section id="create-an-anonymous-function-multiply-that-multiplies-two-numbers." class="level1">
<h1>Create an anonymous function ‘multiply’ that multiplies two numbers.</h1>
</section>
<section id="your-code-below-2" class="level1">
<h1>YOUR CODE BELOW</h1>
</section>
<section id="your-code-above-2" class="level1">
<h1>YOUR CODE ABOVE</h1>
</section>
<section id="test-your-function-3" class="level1">
<h1>Test your function</h1>
<p><span class="citation" data-cites="assert">@assert</span> multiply(10, 5) == 50 “The result is $(multiply(10, 5)) but should be 50.”</p>
<section id="section-4-multiple-dispatch" class="level2">
<h2 class="anchored" data-anchor-id="section-4-multiple-dispatch">Section 4: Multiple Dispatch</h2>
</section>
</section>
<section id="section-4" class="level1">
<h1>—————————-</h1>
<p>println(“Section 4: Multiple Dispatch”)</p>
<p>#= Multiple dispatch in Julia allows defining function behavior based on argument types, promoting code reuse and clarity. It’s a powerful feature for designing flexible and extensible functions. We first define a generic version and then provide specific implementations for different types: =# function operation(a, b) “Generic operation for objects of type $(typeof(a)) and $(typeof(b))” end</p>
</section>
<section id="the-specific-implementations-are" class="level1">
<h1>The specific implementations are:</h1>
<p>operation(a::Number, b::Number) = a + b # Specific method for Number types. operation(a::String, b::String) = string(a, b) # Specific method for String types.</p>
</section>
<section id="test-with-different-types-of-arguments." class="level1">
<h1>Test with different types of arguments.</h1>
<p>result1 = operation(10, 20) # Numeric addition. result2 = operation(“Hello,”, “World!”) # String concatenation. result3 = operation(“Hello,”, 20) # Generic implementation.</p>
<section id="exercise-4.1" class="level2">
<h2 class="anchored" data-anchor-id="exercise-4.1">Exercise 4.1:</h2>
<p>#= Choose the result that should be asserted in the following to equal the expected value on the right side of the conditional statement. Hint: The answer is easy, you just have to change the comparisons. =#</p>
</section>
</section>
<section id="your-changes-below-1" class="level1">
<h1>YOUR CHANGES BELOW</h1>
<p><span class="citation" data-cites="assert">@assert</span> result1 == “Hello, World!” <span class="citation" data-cites="assert">@assert</span> result3 == 30 <span class="citation" data-cites="assert">@assert</span> result2 == “Generic operation for objects of type String and Int64”</p>
</section>
<section id="your-changes-above-1" class="level1">
<h1>YOUR CHANGES ABOVE</h1>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
</section>
</section>
<section id="section-5" class="level1">
<h1>———–</h1>
<p>println() println(“Great work! You’ve just completed the tutorial on functions in Julia.”) println(“You now have a first understanding of how to create, use, and understand”) println(“functions in Julia. Continue to the next file to learn more.”)</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>